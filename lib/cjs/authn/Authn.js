"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
    decodeAttestationObject: function() {
        return decodeAttestationObject;
    },
    toCredential: function() {
        return toCredential;
    }
});
const _crypto = require("@cosmjs/crypto");
const _encoding = require("@cosmjs/encoding");
const _cborx = require("cbor-x");
const _elliptic = /*#__PURE__*/ _interop_require_default(require("elliptic"));
function _interop_require_default(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
const p256 = new _elliptic.default.ec("p256");
const decodeAttestationObject = (bytes)=>{
    const decoded = (0, _cborx.decode)(bytes);
    let authData = decoded.authData;
    const rpIdHash = authData.slice(0, 32);
    const flags = authData.slice(32, 33);
    const signCount = authData.slice(33, 37);
    const attestedCredentialData = authData.slice(37);
    const AAGUID = attestedCredentialData.slice(0, 16);
    const credentialIdLength = attestedCredentialData.slice(16, 18);
    const credentialIdLenghInt = Buffer.from(credentialIdLength).readUIntBE(0, credentialIdLength.length);
    const credentialId = attestedCredentialData.slice(18, 18 + credentialIdLenghInt);
    const credentialPublicKey = attestedCredentialData.slice(18 + credentialIdLenghInt);
    return {
        fmt: decoded.fmt,
        attStmt: decoded.attStmt,
        authData: {
            rpIdHash,
            flags,
            signCount,
            attestedCredentialData: {
                AAGUID,
                credentialIdLength,
                credentialId,
                credentialPublicKey: decodeCredentialPublicKey(credentialPublicKey)
            }
        }
    };
};
const decodeCredentialPublicKey = (res)=>{
    const decoded = (0, _cborx.decode)(res);
    return {
        crv: decoded[-1],
        x: decoded[-2],
        y: decoded[-3],
        privateKey: decoded[-4],
        kty: decoded[1],
        kid: decoded[2],
        alg: decoded[3],
        key_ops: decoded[4],
        "Base IV": decoded[5]
    };
};
const toCredential = (rawId, { x, y })=>{
    console.log({
        rawId
    });
    const uncompressed = new Uint8Array([
        0x04,
        ...x,
        ...y
    ]);
    const keyBytes = Uint8Array.from(p256.keyFromPublic(uncompressed).getPublic(true, "array"));
    const addressBytes = new _crypto.Sha256((0, _crypto.sha256)((0, _encoding.toAscii)("kujira.crypto.authn.PubKey"))).update(keyBytes).digest();
    const address = (0, _encoding.toBech32)("kujira", addressBytes);
    const id = Buffer.from(rawId).toString("hex");
    return {
        id,
        address,
        pubkey: Buffer.from(keyBytes).toString("hex")
    };
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9hdXRobi9BdXRobi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBTaGEyNTYsIHNoYTI1NiB9IGZyb20gXCJAY29zbWpzL2NyeXB0b1wiO1xuaW1wb3J0IHsgdG9Bc2NpaSwgdG9CZWNoMzIgfSBmcm9tIFwiQGNvc21qcy9lbmNvZGluZ1wiO1xuaW1wb3J0IHsgZGVjb2RlIH0gZnJvbSBcImNib3IteFwiO1xuaW1wb3J0IHsgU2lnbkRvYyB9IGZyb20gXCJjb3NtanMtdHlwZXMvY29zbW9zL3R4L3YxYmV0YTEvdHhcIjtcbmltcG9ydCBlbGxpcHRpYyBmcm9tIFwiZWxsaXB0aWNcIjtcbmNvbnN0IHAyNTYgPSBuZXcgZWxsaXB0aWMuZWMoXCJwMjU2XCIpO1xuXG5leHBvcnQgdHlwZSBBbGdvID0gXCJzZWNwMjU2cjFcIjtcbmV4cG9ydCBpbnRlcmZhY2UgQWNjb3VudERhdGEge1xuICAvKiogQSBwcmludGFibGUgYWRkcmVzcyAodHlwaWNhbGx5IGJlY2gzMiBlbmNvZGVkKSAqL1xuICByZWFkb25seSBhZGRyZXNzOiBzdHJpbmc7XG4gIHJlYWRvbmx5IGFsZ286IEFsZ287XG4gIHJlYWRvbmx5IHB1YmtleTogVWludDhBcnJheTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBdXRoblNpZ25SZXNwb25zZSB7XG4gIC8qKlxuICAgKiBUaGUgc2lnbiBkb2MgdGhhdCB3YXMgc2lnbmVkLlxuICAgKiBUaGlzIG1heSBiZSBkaWZmZXJlbnQgZnJvbSB0aGUgaW5wdXQgc2lnbkRvYyB3aGVuIHRoZSBzaWduZXIgbW9kaWZpZXMgaXQgYXMgcGFydCBvZiB0aGUgc2lnbmluZyBwcm9jZXNzLlxuICAgKi9cbiAgcmVhZG9ubHkgc2lnbmVkOiBTaWduRG9jO1xuICByZWFkb25seSBzaWduYXR1cmU6IHN0cmluZztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBDQk9SU2lnbmF0dXJlIHtcbiAgcmVhZG9ubHkgYXV0aGVudGljYXRvckRhdGE6IHN0cmluZztcbiAgcmVhZG9ubHkgY2xpZW50RGF0YUpTT046IHN0cmluZztcbiAgcmVhZG9ubHkgc2lnbmF0dXJlOiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQXV0aG5DcmVkZW50aWFsIHtcbiAgaWQ6IHN0cmluZztcbiAgYWRkcmVzczogc3RyaW5nO1xuICBwdWJrZXk6IHN0cmluZztcbn1cblxuaW50ZXJmYWNlIENPU0VLZXkge1xuICAvLyAgRUMgaWRlbnRpZmllciAtIFRha2VuIGZyb20gdGhlICBcIkNPU0UgRWxsaXB0aWMgQ3VydmVzXCIgcmVnaXN0cnlcbiAgY3J2OiBudW1iZXI7XG4gIC8vIHgtY29vcmRpbmF0ZVxuICB4OiBVaW50OEFycmF5O1xuICAvLyB5LWNvb3JkaW5hdGVcbiAgeTogVWludDhBcnJheTtcbiAgcHJpdmF0ZUtleT86IFVpbnQ4QXJyYXk7XG4gIC8vIFJGQyA4MTUyIHAgMzRcbiAgLyoqXG4gICAqIElkZW50aWZpY2F0aW9uIG9mIHRoZSBrZXkgdHlwZVxuICAgKiBMb29rdXAgaW4gQ09TRSBLZXkgQ29tbW9uIFBhcmFtZXRlcnNcbiAgICovXG4gIGt0eTogc3RyaW5nIHwgbnVtYmVyO1xuICAvKipcbiAgICogS2V5IGlkZW50aWZpY2F0aW9uIHZhbHVlIC0tIG1hdGNoIHRvIGtpZCBpbiBtZXNzYWdlXG4gICAqL1xuICBraWQ6IFVpbnQ4QXJyYXk7XG4gIC8qKlxuICAgKiBLZXkgdXNhZ2UgcmVzdHJ1Y3Rpb24gdG8gdGhpcyBhbGdvcml0aG1cbiAgICogTG9va3VwIGluIENPU0UgQWxnb3JpdGhtc1xuICAgKi9cbiAgYWxnOiBDT1NFQWxnb3JpdGhtSWRlbnRpZmllcjtcbiAgLyoqXG4gICAqIFJlc3RyaWN0IHNldCBvZiBwcmVtaXNzaWJsZSBvcGVyYXRpb25zXG4gICAqL1xuICBrZXlfb3BzOiAoc3RyaW5nIHwgbnVtYmVyKVtdO1xuICAvKipcbiAgICogQmFzZSBJViB0byBiZSB4b3ItZWQgd2l0aCBQYXJ0aWFsIElWc1xuICAgKi9cbiAgXCJCYXNlIElWXCI6IFVpbnQ4QXJyYXk7XG59XG5cbmV4cG9ydCBjb25zdCBkZWNvZGVBdHRlc3RhdGlvbk9iamVjdCA9IChcbiAgYnl0ZXM6IFVpbnQ4QXJyYXlcbik6IHtcbiAgYXV0aERhdGE6IHtcbiAgICAvLyAzMiBieXRlc1xuICAgIHJwSWRIYXNoOiBVaW50OEFycmF5O1xuICAgIC8vIDEgYnl0ZVxuICAgIGZsYWdzOiBVaW50OEFycmF5O1xuICAgIC8vIDQgYnl0ZXNcbiAgICBzaWduQ291bnQ6IFVpbnQ4QXJyYXk7XG4gICAgLy8gdmFyIC0gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL1dlYl9BdXRoZW50aWNhdGlvbl9BUEkvQXV0aGVudGljYXRvcl9kYXRhI2F0dGVzdGVkY3JlZGVudGlhbGRhdGFcbiAgICBhdHRlc3RlZENyZWRlbnRpYWxEYXRhOiB7XG4gICAgICAvLyAxNiBieXRlc1xuICAgICAgQUFHVUlEOiBVaW50OEFycmF5O1xuICAgICAgLy8gMiBieXRlc1xuICAgICAgY3JlZGVudGlhbElkTGVuZ3RoOiBVaW50OEFycmF5O1xuICAgICAgLy8gY3JlZGVudGlhbElkTGVuZ3RoIGJ5dGVzXG4gICAgICBjcmVkZW50aWFsSWQ6IFVpbnQ4QXJyYXk7XG4gICAgICAvLyB2YXJcbiAgICAgIGNyZWRlbnRpYWxQdWJsaWNLZXk6IENPU0VLZXk7XG4gICAgfTtcbiAgfTtcbiAgZm10OiBcIm5vbmVcIjtcbiAgYXR0U3RtdDoge307XG59ID0+IHtcbiAgY29uc3QgZGVjb2RlZCA9IGRlY29kZShieXRlcyk7XG4gIGxldCBhdXRoRGF0YTogVWludDhBcnJheSA9IGRlY29kZWQuYXV0aERhdGE7XG4gIGNvbnN0IHJwSWRIYXNoID0gYXV0aERhdGEuc2xpY2UoMCwgMzIpO1xuICBjb25zdCBmbGFncyA9IGF1dGhEYXRhLnNsaWNlKDMyLCAzMyk7XG4gIGNvbnN0IHNpZ25Db3VudCA9IGF1dGhEYXRhLnNsaWNlKDMzLCAzNyk7XG4gIGNvbnN0IGF0dGVzdGVkQ3JlZGVudGlhbERhdGEgPSBhdXRoRGF0YS5zbGljZSgzNyk7XG4gIGNvbnN0IEFBR1VJRCA9IGF0dGVzdGVkQ3JlZGVudGlhbERhdGEuc2xpY2UoMCwgMTYpO1xuICBjb25zdCBjcmVkZW50aWFsSWRMZW5ndGggPSBhdHRlc3RlZENyZWRlbnRpYWxEYXRhLnNsaWNlKDE2LCAxOCk7XG4gIGNvbnN0IGNyZWRlbnRpYWxJZExlbmdoSW50ID0gQnVmZmVyLmZyb20oY3JlZGVudGlhbElkTGVuZ3RoKS5yZWFkVUludEJFKFxuICAgIDAsXG4gICAgY3JlZGVudGlhbElkTGVuZ3RoLmxlbmd0aFxuICApO1xuICBjb25zdCBjcmVkZW50aWFsSWQgPSBhdHRlc3RlZENyZWRlbnRpYWxEYXRhLnNsaWNlKFxuICAgIDE4LFxuICAgIDE4ICsgY3JlZGVudGlhbElkTGVuZ2hJbnRcbiAgKTtcbiAgY29uc3QgY3JlZGVudGlhbFB1YmxpY0tleSA9IGF0dGVzdGVkQ3JlZGVudGlhbERhdGEuc2xpY2UoXG4gICAgMTggKyBjcmVkZW50aWFsSWRMZW5naEludFxuICApO1xuXG4gIHJldHVybiB7XG4gICAgZm10OiBkZWNvZGVkLmZtdCxcbiAgICBhdHRTdG10OiBkZWNvZGVkLmF0dFN0bXQsXG4gICAgYXV0aERhdGE6IHtcbiAgICAgIHJwSWRIYXNoLFxuICAgICAgZmxhZ3MsXG4gICAgICBzaWduQ291bnQsXG4gICAgICBhdHRlc3RlZENyZWRlbnRpYWxEYXRhOiB7XG4gICAgICAgIEFBR1VJRCxcbiAgICAgICAgY3JlZGVudGlhbElkTGVuZ3RoLFxuICAgICAgICBjcmVkZW50aWFsSWQsXG4gICAgICAgIGNyZWRlbnRpYWxQdWJsaWNLZXk6IGRlY29kZUNyZWRlbnRpYWxQdWJsaWNLZXkoY3JlZGVudGlhbFB1YmxpY0tleSksXG4gICAgICAgIC8vIGJlY2gzMlB1YmxpY0tleSxcbiAgICAgIH0sXG4gICAgfSxcbiAgfTtcbn07XG5cbmNvbnN0IGRlY29kZUNyZWRlbnRpYWxQdWJsaWNLZXkgPSAocmVzOiBVaW50OEFycmF5KTogQ09TRUtleSA9PiB7XG4gIGNvbnN0IGRlY29kZWQgPSBkZWNvZGUocmVzKTtcbiAgcmV0dXJuIHtcbiAgICBjcnY6IGRlY29kZWRbLTFdLFxuICAgIHg6IGRlY29kZWRbLTJdLFxuICAgIHk6IGRlY29kZWRbLTNdLFxuICAgIHByaXZhdGVLZXk6IGRlY29kZWRbLTRdLFxuICAgIGt0eTogZGVjb2RlZFsxXSxcbiAgICBraWQ6IGRlY29kZWRbMl0sXG4gICAgYWxnOiBkZWNvZGVkWzNdLFxuICAgIGtleV9vcHM6IGRlY29kZWRbNF0sXG4gICAgXCJCYXNlIElWXCI6IGRlY29kZWRbNV0sXG4gIH07XG59O1xuXG5leHBvcnQgY29uc3QgdG9DcmVkZW50aWFsID0gKFxuICByYXdJZDogQXJyYXlCdWZmZXIsXG4gIHsgeCwgeSB9OiBDT1NFS2V5XG4pOiBBdXRobkNyZWRlbnRpYWwgPT4ge1xuICBjb25zb2xlLmxvZyh7IHJhd0lkIH0pO1xuXG4gIGNvbnN0IHVuY29tcHJlc3NlZCA9IG5ldyBVaW50OEFycmF5KFsweDA0LCAuLi54LCAuLi55XSk7XG4gIGNvbnN0IGtleUJ5dGVzID0gVWludDhBcnJheS5mcm9tKFxuICAgIHAyNTYua2V5RnJvbVB1YmxpYyh1bmNvbXByZXNzZWQpLmdldFB1YmxpYyh0cnVlLCBcImFycmF5XCIpXG4gICk7XG4gIGNvbnN0IGFkZHJlc3NCeXRlcyA9IG5ldyBTaGEyNTYoc2hhMjU2KHRvQXNjaWkoXCJrdWppcmEuY3J5cHRvLmF1dGhuLlB1YktleVwiKSkpXG4gICAgLnVwZGF0ZShrZXlCeXRlcylcbiAgICAuZGlnZXN0KCk7XG5cbiAgY29uc3QgYWRkcmVzcyA9IHRvQmVjaDMyKFwia3VqaXJhXCIsIGFkZHJlc3NCeXRlcyk7XG4gIGNvbnN0IGlkID0gQnVmZmVyLmZyb20ocmF3SWQpLnRvU3RyaW5nKFwiaGV4XCIpO1xuICByZXR1cm4ge1xuICAgIGlkLFxuICAgIGFkZHJlc3MsXG4gICAgcHVia2V5OiBCdWZmZXIuZnJvbShrZXlCeXRlcykudG9TdHJpbmcoXCJoZXhcIiksXG4gIH07XG59O1xuIl0sIm5hbWVzIjpbImRlY29kZUF0dGVzdGF0aW9uT2JqZWN0IiwidG9DcmVkZW50aWFsIiwicDI1NiIsImVsbGlwdGljIiwiZWMiLCJieXRlcyIsImRlY29kZWQiLCJkZWNvZGUiLCJhdXRoRGF0YSIsInJwSWRIYXNoIiwic2xpY2UiLCJmbGFncyIsInNpZ25Db3VudCIsImF0dGVzdGVkQ3JlZGVudGlhbERhdGEiLCJBQUdVSUQiLCJjcmVkZW50aWFsSWRMZW5ndGgiLCJjcmVkZW50aWFsSWRMZW5naEludCIsIkJ1ZmZlciIsImZyb20iLCJyZWFkVUludEJFIiwibGVuZ3RoIiwiY3JlZGVudGlhbElkIiwiY3JlZGVudGlhbFB1YmxpY0tleSIsImZtdCIsImF0dFN0bXQiLCJkZWNvZGVDcmVkZW50aWFsUHVibGljS2V5IiwicmVzIiwiY3J2IiwieCIsInkiLCJwcml2YXRlS2V5Iiwia3R5Iiwia2lkIiwiYWxnIiwia2V5X29wcyIsInJhd0lkIiwiY29uc29sZSIsImxvZyIsInVuY29tcHJlc3NlZCIsIlVpbnQ4QXJyYXkiLCJrZXlCeXRlcyIsImtleUZyb21QdWJsaWMiLCJnZXRQdWJsaWMiLCJhZGRyZXNzQnl0ZXMiLCJTaGEyNTYiLCJzaGEyNTYiLCJ0b0FzY2lpIiwidXBkYXRlIiwiZGlnZXN0IiwiYWRkcmVzcyIsInRvQmVjaDMyIiwiaWQiLCJ0b1N0cmluZyIsInB1YmtleSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7SUFxRWFBLHVCQUF1QjtlQUF2QkE7O0lBOEVBQyxZQUFZO2VBQVpBOzs7d0JBbkprQjswQkFDRzt1QkFDWDtpRUFFRjs7Ozs7O0FBQ3JCLE1BQU1DLE9BQU8sSUFBSUMsaUJBQVEsQ0FBQ0MsRUFBRSxDQUFDO0FBZ0V0QixNQUFNSiwwQkFBMEIsQ0FDckNLO0lBd0JBLE1BQU1DLFVBQVVDLElBQUFBLGFBQU0sRUFBQ0Y7SUFDdkIsSUFBSUcsV0FBdUJGLFFBQVFFLFFBQVE7SUFDM0MsTUFBTUMsV0FBV0QsU0FBU0UsS0FBSyxDQUFDLEdBQUc7SUFDbkMsTUFBTUMsUUFBUUgsU0FBU0UsS0FBSyxDQUFDLElBQUk7SUFDakMsTUFBTUUsWUFBWUosU0FBU0UsS0FBSyxDQUFDLElBQUk7SUFDckMsTUFBTUcseUJBQXlCTCxTQUFTRSxLQUFLLENBQUM7SUFDOUMsTUFBTUksU0FBU0QsdUJBQXVCSCxLQUFLLENBQUMsR0FBRztJQUMvQyxNQUFNSyxxQkFBcUJGLHVCQUF1QkgsS0FBSyxDQUFDLElBQUk7SUFDNUQsTUFBTU0sdUJBQXVCQyxPQUFPQyxJQUFJLENBQUNILG9CQUFvQkksVUFBVSxDQUNyRSxHQUNBSixtQkFBbUJLLE1BQU07SUFFM0IsTUFBTUMsZUFBZVIsdUJBQXVCSCxLQUFLLENBQy9DLElBQ0EsS0FBS007SUFFUCxNQUFNTSxzQkFBc0JULHVCQUF1QkgsS0FBSyxDQUN0RCxLQUFLTTtJQUdQLE9BQU87UUFDTE8sS0FBS2pCLFFBQVFpQixHQUFHO1FBQ2hCQyxTQUFTbEIsUUFBUWtCLE9BQU87UUFDeEJoQixVQUFVO1lBQ1JDO1lBQ0FFO1lBQ0FDO1lBQ0FDLHdCQUF3QjtnQkFDdEJDO2dCQUNBQztnQkFDQU07Z0JBQ0FDLHFCQUFxQkcsMEJBQTBCSDtZQUVqRDtRQUNGO0lBQ0Y7QUFDRjtBQUVBLE1BQU1HLDRCQUE0QixDQUFDQztJQUNqQyxNQUFNcEIsVUFBVUMsSUFBQUEsYUFBTSxFQUFDbUI7SUFDdkIsT0FBTztRQUNMQyxLQUFLckIsT0FBTyxDQUFDLENBQUMsRUFBRTtRQUNoQnNCLEdBQUd0QixPQUFPLENBQUMsQ0FBQyxFQUFFO1FBQ2R1QixHQUFHdkIsT0FBTyxDQUFDLENBQUMsRUFBRTtRQUNkd0IsWUFBWXhCLE9BQU8sQ0FBQyxDQUFDLEVBQUU7UUFDdkJ5QixLQUFLekIsT0FBTyxDQUFDLEVBQUU7UUFDZjBCLEtBQUsxQixPQUFPLENBQUMsRUFBRTtRQUNmMkIsS0FBSzNCLE9BQU8sQ0FBQyxFQUFFO1FBQ2Y0QixTQUFTNUIsT0FBTyxDQUFDLEVBQUU7UUFDbkIsV0FBV0EsT0FBTyxDQUFDLEVBQUU7SUFDdkI7QUFDRjtBQUVPLE1BQU1MLGVBQWUsQ0FDMUJrQyxPQUNBLEVBQUVQLENBQUMsRUFBRUMsQ0FBQyxFQUFXO0lBRWpCTyxRQUFRQyxHQUFHLENBQUM7UUFBRUY7SUFBTTtJQUVwQixNQUFNRyxlQUFlLElBQUlDLFdBQVc7UUFBQztXQUFTWDtXQUFNQztLQUFFO0lBQ3RELE1BQU1XLFdBQVdELFdBQVdyQixJQUFJLENBQzlCaEIsS0FBS3VDLGFBQWEsQ0FBQ0gsY0FBY0ksU0FBUyxDQUFDLE1BQU07SUFFbkQsTUFBTUMsZUFBZSxJQUFJQyxjQUFNLENBQUNDLElBQUFBLGNBQU0sRUFBQ0MsSUFBQUEsaUJBQU8sRUFBQyxnQ0FDNUNDLE1BQU0sQ0FBQ1AsVUFDUFEsTUFBTTtJQUVULE1BQU1DLFVBQVVDLElBQUFBLGtCQUFRLEVBQUMsVUFBVVA7SUFDbkMsTUFBTVEsS0FBS2xDLE9BQU9DLElBQUksQ0FBQ2lCLE9BQU9pQixRQUFRLENBQUM7SUFDdkMsT0FBTztRQUNMRDtRQUNBRjtRQUNBSSxRQUFRcEMsT0FBT0MsSUFBSSxDQUFDc0IsVUFBVVksUUFBUSxDQUFDO0lBQ3pDO0FBQ0YifQ==